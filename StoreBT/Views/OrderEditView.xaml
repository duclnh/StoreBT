<UserControl x:Class="StoreBT.Views.OrderEditView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="Transparent">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Nội dung -->
        </Grid.RowDefinitions>

        <!-- ==================== HEADER BAR ==================== -->
        <Grid Margin="25,15,25,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 🔙 Nút quay lại -->
            <Button Grid.Column="0"
                    Width="100"
                    Height="36"
                    Padding="10,0"
                    Background="#EFF6FF"
                    Foreground="#1D4ED8"
                    BorderBrush="#BFDBFE"
                    BorderThickness="1"
                    Cursor="Hand"
                    Click="Back_Click">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72B;" FontSize="14" Margin="0,0,5,0"/>
                    <TextBlock Text="Quay lại"/>
                </StackPanel>
            </Button>

            <!-- 📋 Tiêu đề -->
            <TextBlock 
                       x:Name="txtTitle"
                       Grid.Column="1"
                       Text=""
                       FontSize="20"
                       FontWeight="Bold"
                       Foreground="#1E3A8A"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Grid>

        <!-- ==================== NỘI DUNG CHÍNH ==================== -->
        <Grid Grid.Row="1" Margin="25,15,25,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*"/>
                <!-- Hàng hóa -->
                <ColumnDefinition Width="*"/>
                <!-- Thông tin -->
            </Grid.ColumnDefinitions>

            <!-- ========== DANH SÁCH HÀNG HÓA (TRÁI) ========== -->
            <Border Grid.Column="0"
        Background="White"
        CornerRadius="8"
        Padding="20"
        BorderBrush="#E2E8F0"
        BorderThickness="1">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Thanh tìm kiếm -->
                        <RowDefinition Height="*"/>
                        <!-- Bảng sản phẩm -->
                    </Grid.RowDefinitions>

                    <!-- ====== THANH TÌM KIẾM ====== -->
                    <Border Grid.Row="0"
                CornerRadius="8"
                Background="White"
                BorderBrush="#CBD5E1"
                BorderThickness="1"
                Margin="0,0,0,15"
                Height="40">
                        <Grid>
                            <TextBox x:Name="txtSearch"
                         BorderThickness="0"
                         Style="{StaticResource PlaceholderTextBox}"
                         Tag="Tìm sản phẩm..."
                         Background="Transparent"
                         Padding="10,5,40,5"
                         FontSize="14"
                         TextChanged="txtSearch_TextChanged"/>

                            <Button Width="auto"
                        Height="28"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,6,0"
                        Background="Transparent"
                        BorderBrush="{x:Null}"
                        Cursor="Hand"
                        ToolTip="Quét mã vạch"
                        Click="btnScanBarcode_Click">
                                <Image Source="/Assets/Icons/scan.png"
                                Width="40"
                                Height="auto"
                                Stretch="Fill"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"/>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- ====== BẢNG SẢN PHẨM ====== -->
                    <DataGrid Grid.Row="1"
                              x:Name="ProductGrid"
                              AutoGenerateColumns="False"
                              HeadersVisibility="Column"
                              CanUserAddRows="False"
                              RowHeight="40"
                              ColumnHeaderHeight="40"
                              Background="White"
                              BorderBrush="#E2E8F0"
                              AlternatingRowBackground="#F8FAFC"
                              SelectionMode="Single"
                              FontSize="14"
                              IsReadOnly="True"
                              Margin="0"
                              MouseDoubleClick="ProductGrid_MouseDoubleClick">

                        <DataGrid.Columns>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Mã vạch" Binding="{Binding Barcode}" Width="120"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Tên sản phẩm" Binding="{Binding Name}" Width="1*"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Loại" Binding="{Binding Category}" Width="150"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Giá bán" Binding="{Binding Price, StringFormat={}{0:N0} ₫}" Width="120"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Tồn kho" Binding="{Binding Stock}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- ========== THÔNG TIN ĐƠN HÀNG (PHẢI) ========== -->
            <Border Grid.Column="1" Background="White" CornerRadius="8" Padding="20" Margin="20,0,0,0"
        BorderBrush="#E2E8F0" BorderThickness="1">
                <StackPanel>

                    <!-- 🧍 Thông tin khách hàng -->
                    <!--
                    <TextBlock Text="👤 Thông tin khách hàng" FontWeight="Bold" FontSize="16"/>

                    -->
                    <!-- Chọn khách hàng có sẵn -->
                    <!--
                    <Border CornerRadius="8" BorderBrush="#CCC" BorderThickness="1" Padding="2" Panel.ZIndex="3">
                        <ComboBox x:Name="CustomerComboBox"
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id"
                          Height="32"
                          IsEditable="True"
                          IsTextSearchEnabled="True"
                          StaysOpenOnEdit="True"
                          BorderThickness="0"
                          Background="Transparent"   
                          SelectionChanged="CustomerComboBox_SelectionChanged"
                          VerticalContentAlignment="Center"
                          Padding="5"/>
                    </Border>

                    -->
                    <!-- Nhập khách hàng mới -->
                    <!--
                    <StackPanel x:Name="NewCustomerPanel" Margin="0,5,0,0">
                        <StackPanel Margin="0,5">
                            <TextBlock Text="Tên khách hàng" FontWeight="SemiBold" Foreground="#1E3A8A" Margin="0,0,0,4"/>
                            <TextBox Style="{StaticResource PlaceholderTextBox}" x:Name="txtName" Tag="Nhập tên khách hàng" Padding="10"/>
                        </StackPanel>

                        <StackPanel Margin="0,5">
                            <TextBlock Text="Số điện thoại" FontWeight="SemiBold" Foreground="#1E3A8A" Margin="0,0,0,4"/>
                            <TextBox Style="{StaticResource PlaceholderTextBox}" x:Name="txtPhone" Tag="Nhập số điện thoại" Padding="10"/>
                        </StackPanel>
                        <StackPanel Margin="0,5">
                            <TextBlock Text="Địa chỉ" FontWeight="SemiBold" Foreground="#1E3A8A" Margin="0,0,0,4"/>
                            <TextBox Style="{StaticResource PlaceholderTextBox}" x:Name="txtAddress" Tag="Nhập địa chỉ" Padding="10"/>
                        </StackPanel>
                    </StackPanel>

                    <Separator Margin="0,10,0,10"/>-->

                    <!-- 🧺 Danh sách sản phẩm chọn -->
                    <TextBlock Text="🧺 Sản phẩm đã chọn:" FontWeight="Bold" FontSize="16"/>
                    <DataGrid x:Name="CartGrid"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="False"
                  AlternatingRowBackground="#F9FAFB"
                  HeadersVisibility="Column"
                  FontSize="14"
                  Height="180"
                  CellEditEnding="MyGrid_CellEditEnding">
                        <DataGrid.Resources>
                            <!-- 🧩 Style bỏ màu nền khi chọn -->
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black"/>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Tên sản phẩm" Binding="{Binding Product.Name}" Width="2*" IsReadOnly="True"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Giá" Binding="{Binding UnitPrice, StringFormat={}{0:N0} ₫}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="SL" Binding="{Binding Quantity}" Width="60"/>
                            <DataGridTextColumn ElementStyle="{StaticResource CenterTextCell}" Header="Thành tiền" Binding="{Binding Total, StringFormat={}{0:N0} ₫}" Width="90" IsReadOnly="True"/>
                            <!-- 🧩 Cột Thao tác -->
                            <DataGridTemplateColumn Header="Thao tác" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,10,0">

                                            <!-- ❌ Nút Xóa -->
                                            <Button Width="26" Height="26"
                                                Background="Transparent"
                                                BorderBrush="{x:Null}"
                                                Cursor="Hand"
                                                ToolTip="Xóa sản phẩm"
                                                Click="Delete_Click">
                                                <Image Source="/Assets/Icons/delete.png" Width="18" Height="18"/>
                                            </Button>

                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Separator Margin="0,10,0,10"/>

                    <!-- Ghi chú -->
                    <TextBlock Text="Ghi chú" FontWeight="Bold" FontSize="14"/>
                    <TextBox x:Name="txtNote"
                      Height="32"
                      Padding="8"
                      BorderBrush="#CBD5E1"
                      BorderThickness="1"/>

                    <Separator Margin="0,10,0,10"/>

                    <!-- Giảm giá -->
                    <TextBlock Text="Giảm giá (₫)" FontWeight="Bold" FontSize="14"/>
                    <TextBox x:Name="DiscountInput"
                 Height="32"
                 Padding="8"
                 BorderBrush="#CBD5E1"
                 BorderThickness="1"
                 TextChanged="DiscountInput_TextChanged"/>

                    <!-- Tổng tiền -->
                    <TextBlock Text="Tổng tiền:" FontWeight="Bold" FontSize="14" Margin="0,10,0,0"/>
                    <TextBlock x:Name="TotalAmountText"
                   Text="0 ₫"
                   FontSize="16"
                   Foreground="#1E3A8A"
                   FontWeight="Bold"/>

                    <!-- Nút tạo đơn -->
                    <Button Content="✅  Cập nhật đơn hàng"
                Height="40"
                Background="#2563EB"
                Foreground="White"
                FontWeight="SemiBold"
                BorderBrush="{x:Null}"
                Cursor="Hand"
                Margin="0,15,0,0"
                Click="ConfirmOrder_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
